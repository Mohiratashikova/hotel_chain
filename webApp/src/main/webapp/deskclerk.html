<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DeskClerkRequestManagement</title>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script type="text/javascript">

function updateList(items) {
    $("#my-list").html("");
    i = 0;
    j = 0;
    items.forEach(function (e) {
        $("#my-list").append("<li>" + e + "<a href='profile.jsp'><button>Change</button></a>" + "<button class='cancel' id='" + i + "' type='button'>Cancel</button>" + "</li>");
        i++;
        j++;
    });
}

function getListItems() {
    $.ajax({
        url : 'legendary/deskclerk',
        dataType : 'json',
        success : function(r) {
            updateList(r);
        }
    });
}


function sendListItem() {
	
    var listItem = $("#texttosend").val();
  
    var regExp = new RegExp('^[0-9]'); 
      
    if (regExp.test(listItem) ) {
    	
    	getListItems();
     
    } 
    else {    	
    	alert("Invalid guest identification. Please try again!");   	
    }
    
}

function clearBooking(id) {
    $.ajax({
        url : "legendary/deskclerk/cancel/" + id,
        dataType : 'json',
        success : function(r) {
            updateList(r);
        }
    });
}

function changeBooking(id) {
    $.ajax({
        url : "legendary/deskclerk/change/" + id,
        dataType : 'json',
        success : function(r) {
            updateList(r);
        }
    });
}

$(document).ready(function () { 
    getListItems();
    
    $("#send-item").on('click', function () {
        sendListItem();
    });

    $(document).on('click', '.cancel', function () {
    	clearBooking(this.id);
    });
   
    $(document).on('click', '.change', function () {
    	changeBooking(this.id);
    });
    
});


</script>
</head>
<body>
<h2>Desk Clerk Management</h2><br>

<input type="button" onclick="window.location.href = 'profile.jsp';" value="Create Booking"/><br>

GuestID: <input type="text" id="texttosend">

<button id="send-item" type="button">Search</button><br>

<ul id="my-list"></ul>
</body>
</html>